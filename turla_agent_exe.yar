rule TurlaAgent_exe
{

        meta:
                author = "Penetrum, LLC security researchers 09/16/2020"
                ref = "https://penetrum.com"
                copyright = "Penetrum, LLC"
                description = "Matches the Turla trojan"
                sha256 = "c905f2dec79ccab115ad32578384008696ebab02276f49f12465dcd026c1a615"

        strings:
                $specific1 = "%s<add key=\"%s\" value=\"%s\">"
                $specific2 = "%s<add key=\"%s\" value=\"%s\" />"
                $specific3 = ">$>(>,>0>4>8><>@>D>l>p>t>x>|>"
                $matchable1 = " ''0;!"
                $matchable10 = "!= 87{17"
                $matchable11 = "!This"
                $matchable12 = "%02X"
                $matchable13 = "%02d.%02d.%04d"
                $matchable14 = "%02d.%02d.%04d Log begin:"
                $matchable15 = "%02d/%02d/%04d)"
                $matchable16 = "%02d:%02d:%02d"
                $matchable17 = "%02d:%02d:%02d "
                $matchable18 = "%08X"
                $matchable19 = "%08X is native."
                $matchable2 = " (8PX"
                $matchable20 = "%12d"
                $matchable21 = "%14!0"
                $matchable22 = "%I64u"
                $matchable23 = "%I64u.jpg"
                $matchable24 = "%PROGRAMFILES%"
                $matchable25 = "%SYSTEM%"
                $matchable26 = "%SYSTEMROOT%"
                $matchable3 = " /runas"
                $matchable4 = " ;!<80{`g"
                $matchable5 = " Windows NT %d.%d; SV1)"
                $matchable6 = "!'!1"
                $matchable7 = "!,%069<{0-0"
                $matchable8 = "!4%<fg1{0-0"
                $matchable9 = "!= 87{11"

        condition:
                13 of ($matchable*) and all of ($specific*)
}
