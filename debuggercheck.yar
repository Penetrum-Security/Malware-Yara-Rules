rule DebuggerCheck:
{
    meta:
        author = "Penetrum, LLC"
        reference = "https://github.com/Penetrum-Security/Malware-Yara-Rules"
        description = "File is most likely trying to detect a debugger"
        
    strings:
        $s1 = "IsDebugged"
        $s2 = "NtGlobalFlags"
        $s3 = "QueryInformationProcess"
        $s4 = "CheckRemoteDebuggerPresent"
        $s5 = "DebugActiveProcess"
        $s6 = "ContinueDebugEvent"
        $s7 = "IsDebuggerPresent"
		    $vm1 = "virtualbox graphics adapter" nocase ascii wide
		    $vm2 = "vmware svga ii" nocase ascii wide
		    $vm3 = "vm additions s3 trio32/64" nocase ascii wide
		    $vm4 = "parallel" nocase ascii wide
		    $vm5 = "remotefx" nocase ascii wide
		    $vm6 = "cirrus logic" nocase ascii wide
		    $vm7 = "matrox" nocase ascii wide
		    $selstr = "SELECT Description FROM Win32_VideoController" nocase ascii wide
		    $selstr2 = "SELECT * FROM Win32_VideoController" nocase ascii wide
        
    condition:
        any of ($s*) and any of ($selstr*) and any of ($vm*)
}
